const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MapLibre-B7zNExhZ.js","assets/index-BFysJf22.js","vendor/2-BcTiMYgl.js","vendor/1-CH-8zZtd.js","assets/rolldown-runtime-B6ubh40S.js","assets/index.BwAmbC.css","assets/shared-D3cVBL1-.js","assets/map-utils-B1HhwOh9.js","assets/style-CBpjoW-E.js","assets/style.iyY6E-.css"])))=>i.map(i=>d[i]);
import{s as e}from"./rolldown-runtime-B6ubh40S.js";import{a as t,n,t as r}from"../vendor/1-CH-8zZtd.js";import{r as i}from"../vendor/2-BcTiMYgl.js";import{Bt as a,Cn as o,In as s,Ln as c,Pn as l,ct as u,pt as d}from"./index-BFysJf22.js";import{i as f,n as p,r as m,t as h}from"./map-utils-B1HhwOh9.js";import"./shared-D3cVBL1-.js";var g=n(),_=e(t(),1),v=e(r(),1),y=(0,_.lazy)(()=>c(()=>import(`./MapLibre-B7zNExhZ.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(e=>({default:e.Maplibre}))),b=class{name=`maplibre`;isAvailable=!0;MapComponent=x;async initialize(){}cleanup(){}};const x=e=>{let t=(0,g.c)(19),{id:n,initialViewState:r,markers:i,selectedMarkerId:a,geoJsonData:o,className:s,style:c,handlers:l,autoFitBounds:u}=e,d=_.useRef(null),f;t[0]===l?f=t[1]:(f=e=>{if(!l?.onGeoJsonClick)return;let t=e.features?.[0];t&&l.onGeoJsonClick(t)},t[0]=l,t[1]=f);let p=f,m;t[2]===Symbol.for(`react.memo_cache_sentinel`)?(m=(e,t,n)=>{d.current?.flyTo({center:[e,t],duration:1e3,zoom:n||14})},t[2]=m):m=t[2];let h=m,b;t[3]===l?b=t[4]:(b=e=>{l?.onMarkerClick?.(e)},t[3]=l,t[4]=b);let x=b,S;t[5]===l?S=t[6]:(S=(e,t)=>{h(e,t),l?.onGeolocate?.(e,t)},t[5]=l,t[6]=S);let C=S,w;return t[7]!==u||t[8]!==s||t[9]!==o||t[10]!==p||t[11]!==C||t[12]!==x||t[13]!==n||t[14]!==r||t[15]!==i||t[16]!==a||t[17]!==c?(w=(0,v.jsx)(y,{id:n,initialViewState:r,markers:i,selectedMarkerId:a,geoJsonData:o,onMarkerClick:x,onGeoJsonClick:p,onGeolocate:C,className:s,style:c,mapRef:d,autoFitBounds:u}),t[7]=u,t[8]=s,t[9]=o,t[10]=p,t[11]=C,t[12]=x,t[13]=n,t[14]=r,t[15]=i,t[16]=a,t[17]=c,t[18]=w):w=t[18],w},S=()=>new b;var C=n();const w=(0,_.createContext)(null),T=()=>{let e=(0,_.use)(w);if(!e)throw Error(`useMapAdapter must be used within a MapProvider`);return e.adapter};var E=S(),D=[{name:`maplibre`,adapter:E,component:E.MapComponent}],O=()=>{let e=a.map;if(!e){let e=D.find(e=>e.adapter.isAvailable)||null;return e&&console.info(`Map: Selected default adapter: ${e.name}`),e}if(typeof e==`string`){let t=D.find(t=>t.name===e&&t.adapter.isAvailable);if(t)return console.info(`Map: Selected specified adapter: ${t.name}`),t;let n=D.find(e=>e.adapter.isAvailable)||null;return n&&console.info(`Map: Specified adapter '${e}' not available, using fallback: ${n.name}`),n}if(Array.isArray(e)){for(let t of e){let e=D.find(e=>e.name===t&&e.adapter.isAvailable);if(e)return console.info(`Map: Selected adapter from priority list: ${e.name}`),e}let t=D.find(e=>e.adapter.isAvailable)||null;return t&&console.info(`Map: None of the priority providers available, using fallback: ${t.name}`),t}let t=D.find(e=>e.adapter.isAvailable)||null;return t?console.info(`Map: Selected default adapter: ${t.name}`):console.warn(`Map: No adapters are available`),t};const k=e=>{let t=(0,C.c)(5),{children:n}=e,r;bb0:{let e;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(e=O(),t[0]=e):e=t[0];let n=e;if(n){let e;t[1]===Symbol.for(`react.memo_cache_sentinel`)?(e={...n.adapter,MapComponent:n.component},t[1]=e):e=t[1],r=e;break bb0}r=null}let i=r,a;t[2]===Symbol.for(`react.memo_cache_sentinel`)?(a={adapter:i},t[2]=a):a=t[2];let o=a,s;return t[3]===n?s=t[4]:(s=(0,v.jsx)(w,{value:o,children:n}),t[3]=n,t[4]=s),s};var A=n(),j=[];const M=e=>{let t=(0,A.c)(27),n,r,i,a,o,s,c,l;t[0]===e?(n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8]):({markers:c,selectedMarkerId:s,onMarkerClick:a,onGeoJsonClick:r,onGeolocate:i,initialViewState:n,autoFitBounds:l,...o}=e,t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=c,t[8]=l);let u=c===void 0?j:c,d=l===void 0?!0:l,p=T(),m;bb0:{if(d){let e;t[9]===n?e=t[10]:(e=n||{longitude:0,latitude:0,zoom:2},t[9]=n,t[10]=e),m=e;break bb0}let e;t[11]!==n||t[12]!==u?(e=n||f(u),t[11]=n,t[12]=u,t[13]=e):e=t[13],m=e}let h=m,g;t[14]!==r||t[15]!==i||t[16]!==a?(g={onMarkerClick:a,onGeoJsonClick:r,onGeolocate:i},t[14]=r,t[15]=i,t[16]=a,t[17]=g):g=t[17];let _=g;if(!p){let e;return t[18]===Symbol.for(`react.memo_cache_sentinel`)?(e=(0,v.jsx)(`div`,{children:`Map provider not available`}),t[18]=e):e=t[18],e}let{MapComponent:y}=p,b;return t[19]!==y||t[20]!==d||t[21]!==h||t[22]!==_||t[23]!==u||t[24]!==o||t[25]!==s?(b=(0,v.jsx)(y,{...o,markers:u,selectedMarkerId:s,initialViewState:h,autoFitBounds:d,handlers:_}),t[19]=y,t[20]=d,t[21]=h,t[22]=_,t[23]=u,t[24]=o,t[25]=s,t[26]=b):b=t[26],b};var N=n();const P=()=>{let e=(0,N.c)(8),{t}=i(),n=l(),r;e[0]===n?r=e[1]:(r=()=>{(0,_.startTransition)(()=>{n(`/`)})},e[0]=n,e[1]=r);let a=r,o;e[2]===t?o=e[3]:(o=t(`explory.back.to.gallery`),e[2]=t,e[3]=o);let s;e[4]===Symbol.for(`react.memo_cache_sentinel`)?(s=(0,v.jsx)(`i`,{className:`i-mingcute-arrow-left-line text-base text-white`}),e[4]=s):s=e[4];let c;return e[5]!==a||e[6]!==o?(c=(0,v.jsx)(u,{className:`absolute top-4 left-4 z-50`,onClick:a,title:o,children:s}),e[5]=a,e[6]=o,e[7]=c):c=e[7],c};var F=n();const I=e=>{let t=(0,F.c)(47),{markersCount:n,bounds:r}=e,{t:a}=i(),[o,s]=(0,_.useState)(!1),c,l,u;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(c={opacity:0,x:20},l={opacity:1,x:0},u={duration:.4,delay:.2},t[0]=c,t[1]=l,t[2]=u):(c=t[0],l=t[1],u=t[2]);let f,p,m;t[3]===Symbol.for(`react.memo_cache_sentinel`)?(f={opacity:0,y:10},p={opacity:1,y:0},m={duration:.3,delay:.3},t[3]=f,t[4]=p,t[5]=m):(f=t[3],p=t[4],m=t[5]);let h;t[6]===Symbol.for(`react.memo_cache_sentinel`)?(h=(0,v.jsx)(`div`,{className:`bg-blue/10 ring-blue/20 flex h-11 w-11 flex-shrink-0 items-center justify-center rounded-xl ring-1 ring-inset`,children:(0,v.jsx)(`i`,{className:`i-mingcute-map-line text-blue text-lg`})}),t[6]=h):h=t[6];let g;t[7]===a?g=t[8]:(g=a(`explory.explore.map`),t[7]=a,t[8]=g);let y;t[9]===g?y=t[10]:(y=(0,v.jsx)(`h1`,{className:`text-text text-lg leading-tight font-semibold tracking-tight`,children:g}),t[9]=g,t[10]=y);let b;t[11]===o?b=t[12]:(b=()=>s(!o),t[11]=o,t[12]=b);let x=o?`Collapse`:`Expand`,S=o?180:0,C;t[13]===S?C=t[14]:(C={rotate:S},t[13]=S,t[14]=C);let w;t[15]===Symbol.for(`react.memo_cache_sentinel`)?(w={duration:.2},t[15]=w):w=t[15];let T;t[16]===C?T=t[17]:(T=(0,v.jsx)(d.i,{className:`i-mingcute-down-line text-text-secondary text-base`,animate:C,transition:w}),t[16]=C,t[17]=T);let E;t[18]!==b||t[19]!==x||t[20]!==T?(E=(0,v.jsx)(`button`,{type:`button`,onClick:b,className:`bg-fill-secondary/50 ring-fill-tertiary/20 hover:bg-fill-tertiary relative -top-2 -mb-2 flex size-8 flex-shrink-0 items-center justify-center rounded-xl ring-1 transition-all duration-200 ring-inset`,"aria-label":x,children:T}),t[18]=b,t[19]=x,t[20]=T,t[21]=E):E=t[21];let D;t[22]!==E||t[23]!==y?(D=(0,v.jsxs)(`div`,{className:`flex items-center justify-between`,children:[y,E]}),t[22]=E,t[23]=y,t[24]=D):D=t[24];let O;t[25]===Symbol.for(`react.memo_cache_sentinel`)?(O=(0,v.jsx)(`div`,{className:`bg-green h-1.5 w-1.5 rounded-full`}),t[25]=O):O=t[25];let k;t[26]!==n||t[27]!==a?(k=a(`explory.found.locations`,{count:n}),t[26]=n,t[27]=a,t[28]=k):k=t[28];let A;t[29]===k?A=t[30]:(A=(0,v.jsx)(`div`,{className:`mt-1.5 flex items-center gap-2`,children:(0,v.jsxs)(`div`,{className:`bg-green/10 ring-green/20 flex items-center gap-1.5 rounded-full px-2.5 py-1 ring-1 ring-inset`,children:[O,(0,v.jsx)(`span`,{className:`text-text-secondary text-xs font-medium`,children:k})]})}),t[29]=k,t[30]=A);let j;t[31]!==D||t[32]!==A?(j=(0,v.jsx)(`div`,{className:`p-5`,children:(0,v.jsxs)(d.div,{className:`flex items-center gap-4`,initial:f,animate:p,transition:m,children:[h,(0,v.jsxs)(`div`,{className:`min-w-0 flex-1`,children:[D,A]})]})}),t[31]=D,t[32]=A,t[33]=j):j=t[33];let M=o&&r?`auto`:0,N=o&&r?1:0,P;t[34]!==M||t[35]!==N?(P={height:M,opacity:N},t[34]=M,t[35]=N,t[36]=P):P=t[36];let I;t[37]===Symbol.for(`react.memo_cache_sentinel`)?(I={duration:.3,ease:`easeInOut`},t[37]=I):I=t[37];let L;t[38]!==r||t[39]!==a?(L=r&&(0,v.jsxs)(`div`,{className:`border-fill-secondary border-t px-5 pt-4 pb-5`,children:[(0,v.jsxs)(`div`,{className:`mb-4 flex items-center gap-2.5`,children:[(0,v.jsx)(`i`,{className:`i-mingcute-location-line text-text-secondary`}),(0,v.jsx)(`span`,{className:`text-text text-sm font-medium tracking-tight`,children:a(`explory.shooting.range`)})]}),(0,v.jsxs)(`div`,{className:`space-y-3`,children:[(0,v.jsxs)(`div`,{className:`bg-fill-vibrant-quinary border-fill-tertiary rounded-xl border p-4`,children:[(0,v.jsxs)(`div`,{className:`text-text-secondary mb-2 flex items-center gap-2 text-xs font-medium tracking-wide uppercase`,children:[(0,v.jsx)(`i`,{className:`i-mingcute-arrow-left-down-line text-sm`}),`Southwest`]}),(0,v.jsxs)(`div`,{className:`space-y-1`,children:[(0,v.jsxs)(`div`,{className:`text-text flex items-center justify-between`,children:[(0,v.jsx)(`span`,{className:`text-xs font-medium`,children:`Lat`}),(0,v.jsxs)(`span`,{className:`font-mono text-sm tabular-nums`,children:[r.minLat.toFixed(6),`¬∞`]})]}),(0,v.jsxs)(`div`,{className:`text-text flex items-center justify-between`,children:[(0,v.jsx)(`span`,{className:`text-xs font-medium`,children:`Lng`}),(0,v.jsxs)(`span`,{className:`font-mono text-sm tabular-nums`,children:[r.minLng.toFixed(6),`¬∞`]})]})]})]}),(0,v.jsxs)(`div`,{className:`bg-fill-vibrant-quinary border-fill-tertiary rounded-xl border p-4`,children:[(0,v.jsxs)(`div`,{className:`text-text-secondary mb-2 flex items-center gap-2 text-xs font-medium tracking-wide uppercase`,children:[(0,v.jsx)(`i`,{className:`i-mingcute-arrow-right-up-line text-sm`}),`Northeast`]}),(0,v.jsxs)(`div`,{className:`space-y-1`,children:[(0,v.jsxs)(`div`,{className:`text-text flex items-center justify-between`,children:[(0,v.jsx)(`span`,{className:`text-xs font-medium`,children:`Lat`}),(0,v.jsxs)(`span`,{className:`font-mono text-sm tabular-nums`,children:[r.maxLat.toFixed(6),`¬∞`]})]}),(0,v.jsxs)(`div`,{className:`text-text flex items-center justify-between`,children:[(0,v.jsx)(`span`,{className:`text-xs font-medium`,children:`Lng`}),(0,v.jsxs)(`span`,{className:`font-mono text-sm tabular-nums`,children:[r.maxLng.toFixed(6),`¬∞`]})]})]})]})]}),(0,v.jsx)(`div`,{className:`bg-gray/5 mt-4 rounded-xl p-3`,children:(0,v.jsxs)(`div`,{className:`text-text-secondary flex items-center gap-2 text-xs`,children:[(0,v.jsx)(`i`,{className:`i-mingcute-grid-line`}),(0,v.jsxs)(`span`,{className:`font-medium`,children:[`Coverage: ~`,Math.abs((r.maxLat-r.minLat)*(r.maxLng-r.minLng)*111*111).toFixed(1),` `,`km¬≤`]})]})})]}),t[38]=r,t[39]=a,t[40]=L):L=t[40];let R;t[41]!==P||t[42]!==L?(R=(0,v.jsx)(d.div,{initial:!1,animate:P,transition:I,className:`overflow-hidden`,children:L}),t[41]=P,t[42]=L,t[43]=R):R=t[43];let z;return t[44]!==j||t[45]!==R?(z=(0,v.jsx)(d.div,{className:`absolute top-4 right-4 z-40 max-w-xs`,initial:c,animate:l,transition:u,children:(0,v.jsxs)(`div`,{className:`bg-material-thick border-fill-tertiary rounded-2xl border shadow-2xl backdrop-blur-[120px]`,children:[j,R]})}),t[44]=j,t[45]=R,t[46]=z):z=t[46],z};var L=n();const R=()=>{let e=(0,L.c)(21),{t}=i(),n,r,a;e[0]===Symbol.for(`react.memo_cache_sentinel`)?(n={opacity:0,y:20},r={opacity:1,y:0},a={duration:.4},e[0]=n,e[1]=r,e[2]=a):(n=e[0],r=e[1],a=e[2]);let o;e[3]===Symbol.for(`react.memo_cache_sentinel`)?(o=(0,v.jsx)(d.div,{className:`loading-icon mb-4 text-4xl`,initial:{scale:.8},animate:{scale:1},transition:{duration:.4,delay:.1},children:`üìç`}),e[3]=o):o=e[3];let s,c,l;e[4]===Symbol.for(`react.memo_cache_sentinel`)?(s={opacity:0},c={opacity:1},l={duration:.3,delay:.2},e[4]=s,e[5]=c,e[6]=l):(s=e[4],c=e[5],l=e[6]);let u;e[7]===t?u=e[8]:(u=t(`explory.loading.map`),e[7]=t,e[8]=u);let f;e[9]===u?f=e[10]:(f=(0,v.jsx)(d.div,{className:`text-lg font-medium text-gray-900 dark:text-gray-100`,initial:s,animate:c,transition:l,children:u}),e[9]=u,e[10]=f);let p,m,h;e[11]===Symbol.for(`react.memo_cache_sentinel`)?(h={opacity:0},p={opacity:1},m={duration:.3,delay:.3},e[11]=p,e[12]=m,e[13]=h):(p=e[11],m=e[12],h=e[13]);let g;e[14]===t?g=e[15]:(g=t(`explory.parsing.location`),e[14]=t,e[15]=g);let _;e[16]===g?_=e[17]:(_=(0,v.jsx)(d.p,{className:`text-sm text-gray-600 dark:text-gray-400`,initial:h,animate:p,transition:m,children:g}),e[16]=g,e[17]=_);let y;return e[18]!==_||e[19]!==f?(y=(0,v.jsx)(`div`,{className:`flex h-full w-full items-center justify-center`,children:(0,v.jsxs)(d.div,{className:`text-center`,initial:n,animate:r,transition:a,children:[o,f,_]})}),e[18]=_,e[19]=f,e[20]=y):y=e[20],y};var z=n();const B=()=>{let e=(0,z.c)(1),t;return e[0]===Symbol.for(`react.memo_cache_sentinel`)?(t=(0,v.jsx)(k,{children:(0,v.jsx)(V,{})}),e[0]=t):t=e[0],t};var V=()=>{let{t:e}=i(),[t,n]=s(),[r,a]=(0,_.useState)(!0),[c,l]=(0,_.useState)(null),[u,g]=(0,_.useState)([]),[y,b]=(0,_.useState)(!0),x=(0,_.useCallback)(e=>{let r=new URLSearchParams(t);t.get(`photoId`)===e.id?r.delete(`photoId`):r.set(`photoId`,e.id),n(r,{replace:!0}),b(!1)},[t,n]),S=(0,_.useMemo)(()=>u.length===0?null:h(u),[u]);(0,_.useEffect)(()=>{(async()=>{a(!0),l(null);try{let e=m(o.getPhotos());g(e),console.info(`Found ${e.length} photos with GPS coordinates`)}catch(e){let t=e instanceof Error?e:Error(`Failed to load photo markers`);l(t),console.error(`Failed to load photo markers:`,t)}finally{a(!1)}})()},[g]);let{latitude:C,longitude:w,zoom:T,photoId:E}=(0,_.useMemo)(()=>{let e=t.get(`photoId`);if(e){let t=p(o.getPhoto(e)?.exif??null);if(t)return{latitude:t.latitude,longitude:t.longitude,zoom:15,photoId:e}}return{latitude:null,longitude:null,zoom:null,photoId:e}},[t]),D=(0,_.useMemo)(()=>C!==null&&w!==null?{latitude:C,longitude:w,zoom:T??15}:f(u),[u,C,w,T]);return r?(0,v.jsx)(R,{}):c?(0,v.jsx)(`div`,{className:`flex h-full w-full items-center justify-center`,children:(0,v.jsxs)(`div`,{className:`text-center`,children:[(0,v.jsx)(`div`,{className:`mb-4 text-4xl`,children:`‚ùå`}),(0,v.jsx)(`div`,{className:`text-lg font-medium text-red-900 dark:text-red-100`,children:e(`explory.map.error.title`)}),(0,v.jsx)(`p`,{className:`text-sm text-red-600 dark:text-red-400`,children:e(`explory.map.error.description`)})]})}):(0,v.jsxs)(`div`,{className:`absolute h-full w-full`,children:[(0,v.jsx)(P,{}),(0,v.jsx)(I,{markersCount:u.length,bounds:S}),(0,v.jsx)(d.div,{initial:{opacity:0,scale:1.02},animate:{opacity:1,scale:1},transition:{duration:.6,delay:.1},className:`h-full w-full`,children:(0,v.jsx)(M,{markers:u,initialViewState:D,autoFitBounds:y&&C===null&&w===null,selectedMarkerId:E,onMarkerClick:x,className:`h-full w-full`})})]})};export{B as MapSection};