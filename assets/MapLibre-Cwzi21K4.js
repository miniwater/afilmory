import{s as e}from"./rolldown-runtime-B6ubh40S.js";import{a as t,n,t as r}from"../vendor/1-aoytCc18.js";import"../vendor/2-yDtSejqy.js";import{Bt as i}from"./index-Dde1Xkod.js";import{t as a}from"./style-VgUbXrPw.js";import{c as o,t as s}from"./map-utils-BQ17OUQB.js";import{a as ee,c as te,i as ne,n as re,o as ie,r as ae,s as oe,t as se}from"./shared-D2NnMMd-.js";var c=n(),l=e(t()),u=e(r());const d=e=>{let t=(0,c.c)(53),{id:n,initialViewState:r,markers:d,selectedMarkerId:f,geoJsonData:p,onMarkerClick:m,onGeoJsonClick:h,onGeolocate:g,onClusterClick:_,className:v,style:y,mapRef:b,autoFitBounds:x}=e,S=r===void 0?ae:r,C=d===void 0?se:d,w=v===void 0?`w-full h-full`:v,T=y===void 0?re:y,E=x===void 0?!0:x,[D,O]=(0,l.useState)(S.zoom),[k,A]=(0,l.useState)(S),[j,le]=(0,l.useState)(!1),[M,ue]=(0,l.useState)(!1),N;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(N={type:i.mapProjection??`mercator`},t[0]=N):N=t[0];let de=N,P;t[1]===m?P=t[2]:(P=e=>{m?.(e)},t[1]=m,t[2]=P);let F=P,I;t[3]!==C||t[4]!==m||t[5]!==f?(I=()=>{if(f&&m){let e=C.find(e=>e.id===f);e&&m(e)}},t[3]=C,t[4]=m,t[5]=f,t[6]=I):I=t[6];let L=I,R;t[7]!==D||t[8]!==C?(R=te(C,D),t[7]=D,t[8]=C,t[9]=R):R=t[9];let z=R,fe=ce,B;t[10]!==E||t[11]!==M||t[12]!==j||t[13]!==b||t[14]!==C?(B=()=>{if(!E||C.length===0||!j||M)return;let e=s(C);if(!e)return;if(ue(!0),C.length===1){let e={longitude:C[0].longitude,latitude:C[0].latitude,zoom:13};A(e),O(e.zoom);return}if(b?.current?.getMap){let n=b.current.getContainer(),r=n.offsetWidth,i=n.offsetHeight,a=r*.1,o=i*.1,s={top:Math.max(o,40),bottom:Math.max(o,40),left:Math.max(a,40),right:Math.max(a,40)};try{b.current.getMap().fitBounds([[e.minLng,e.minLat],[e.maxLng,e.maxLat]],{padding:s,duration:800,maxZoom:15})}catch(n){let r=n;console.warn(`使用 fitBounds 失败，使用备用方案:`,r),t(e)}}else t(e);function t(e){if(!e)return;let t=e.maxLat-e.minLat,n=e.maxLng-e.minLng,r=Math.max(fe(t,n)-1,2);A({longitude:e.centerLng,latitude:e.centerLat,zoom:r}),O(r)}},t[10]=E,t[11]=M,t[12]=j,t[13]=b,t[14]=C,t[15]=B):B=t[15];let V=B,H;t[16]===Symbol.for(`react.memo_cache_sentinel`)?(H=()=>{le(!0)},t[16]=H):H=t[16];let pe=H,U,W;t[17]===V?(U=t[18],W=t[19]):(U=()=>{let e=setTimeout(()=>{V()},100);return()=>clearTimeout(e)},W=[V],t[17]=V,t[18]=U,t[19]=W),(0,l.useEffect)(U,W);let G,K;t[20]===Symbol.for(`react.memo_cache_sentinel`)?(G={width:`100%`,height:`100%`},K=a(),t[20]=G,t[21]=K):(G=t[20],K=t[21]);let q;t[22]===p?q=t[23]:(q=p?[`data`]:void 0,t[22]=p,t[23]=q);let J;t[24]===Symbol.for(`react.memo_cache_sentinel`)?(J=e=>{O(e.viewState.zoom),A(e.viewState)},t[24]=J):J=t[24];let Y;t[25]===g?Y=t[26]:(Y=(0,u.jsx)(ee,{onGeolocate:g}),t[25]=g,t[26]=Y);let X;if(t[27]!==z||t[28]!==F||t[29]!==L||t[30]!==_||t[31]!==f){let e;t[33]!==F||t[34]!==L||t[35]!==_||t[36]!==f?(e=e=>{if(e.properties.cluster)return(0,u.jsx)(oe,{longitude:e.geometry.coordinates[0],latitude:e.geometry.coordinates[1],pointCount:e.properties.point_count||0,representativeMarker:e.properties.marker,clusteredPhotos:e.properties.clusteredPhotos,onClusterClick:_},`cluster-${e.geometry.coordinates[0]}-${e.geometry.coordinates[1]}`);{let{marker:t}=e.properties;return t?(0,u.jsx)(ne,{marker:t,isSelected:f===t.id,onClick:F,onClose:L},t.id):null}},t[33]=F,t[34]=L,t[35]=_,t[36]=f,t[37]=e):e=t[37],X=z.map(e),t[27]=z,t[28]=F,t[29]=L,t[30]=_,t[31]=f,t[32]=X}else X=t[32];let Z;t[38]===p?Z=t[39]:(Z=p&&(0,u.jsx)(ie,{data:p}),t[38]=p,t[39]=Z);let Q;t[40]!==n||t[41]!==b||t[42]!==h||t[43]!==q||t[44]!==Y||t[45]!==X||t[46]!==Z||t[47]!==k?(Q=(0,u.jsxs)(o,{id:n,ref:b,...k,style:G,mapStyle:K,projection:de,attributionControl:!1,interactiveLayerIds:q,onClick:h,onLoad:pe,onMove:J,children:[Y,X,Z]}),t[40]=n,t[41]=b,t[42]=h,t[43]=q,t[44]=Y,t[45]=X,t[46]=Z,t[47]=k,t[48]=Q):Q=t[48];let $;return t[49]!==w||t[50]!==T||t[51]!==Q?($=(0,u.jsx)(`div`,{className:w,style:T,children:Q}),t[49]=w,t[50]=T,t[51]=Q,t[52]=$):$=t[52],$};function ce(e,t){let n=Math.max(e,t);return n<.001?16:n<.01?14:n<.1?11:n<1?8:n<10?5:2}export{d as Maplibre};